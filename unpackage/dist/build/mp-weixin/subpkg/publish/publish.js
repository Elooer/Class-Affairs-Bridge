(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subpkg/publish/publish"],{"2daa":function(t,e,n){},3619:function(t,e,n){"use strict";n.r(e);var i=n("6fd6"),r=n("5385");for(var s in r)"default"!==s&&function(t){n.d(e,t,(function(){return r[t]}))}(s);n("9833");var a,u=n("f0c5"),o=Object(u["a"])(r["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],a);e["default"]=o.exports},5385:function(t,e,n){"use strict";n.r(e);var i=n("60fb"),r=n.n(i);for(var s in i)"default"!==s&&function(t){n.d(e,t,(function(){return i[t]}))}(s);e["default"]=r.a},"60fb":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("a34a")),r=n("26cb"),s=a(n("8865"));function a(t){return t&&t.__esModule?t:{default:t}}function u(t,e){return l(t)||c(t,e)||m(t,e)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,s=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done);i=!0)if(n.push(a.value),e&&n.length===e)break}catch(o){r=!0,s=o}finally{try{i||null==u["return"]||u["return"]()}finally{if(r)throw s}}return n}}function l(t){if(Array.isArray(t))return t}function d(t,e,n,i,r,s,a){try{var u=t[s](a),o=u.value}catch(c){return void n(c)}u.done?e(o):Promise.resolve(o).then(i,r)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var s=t.apply(e,n);function a(t){d(s,i,r,a,u,"next",t)}function u(t){d(s,i,r,a,u,"throw",t)}a(void 0)}))}}function p(t){return g(t)||b(t)||m(t)||h()}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(t,e){if(t){if("string"===typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(t,e):void 0}}function b(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function g(t){if(Array.isArray(t))return w(t)}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var y=function(){n.e("components/xuan-popup/xuan-popup").then(function(){return resolve(n("f95e"))}.bind(null,n)).catch(n.oe)},F=function(){n.e("components/wyb-popup/wyb-popup").then(function(){return resolve(n("aa77"))}.bind(null,n)).catch(n.oe)},L={components:{mpopup:y,wybPopup:F},mixins:[s.default],onLoad:function(t){this.getTaskList(),this.getWorkList(),this.title=t.title,t.cid&&(this.cid=t.cid,this.getStuList()),t.index&&(this.index=t.index)},onShow:function(){this.getTaskList(),this.getWorkList()},data:function(){return{title:"",taskTitle:"",taskDetail:"",cid:"",stuList:[],pubPerson:"",pubId:0,imageStyles:{width:84,height:84},images:[],datetimesingle:"",value:[],index:0,taskUnFinishedList:[],workUnFinishedList:[],uploadFilesPath:[],pubUrlArray:[],allStuSumbitUrl:"",imgType:["jpg","png","jpeg","gif","bmp"],imgFiles:[],filesArr:[],imgFiles2:[]}},computed:v({},(0,r.mapState)("my_user",["id"])),methods:{back:function(){t.navigateBack({delta:1})},changeLog:function(t){},select:function(t){this.uploadFilesPath=[].concat(p(this.uploadFilesPath),[t.tempFilePaths[0]])},delFile:function(t){this.uploadFilesPath.pop(this.uploadFilesPath.find((function(e){return e===t.path})))},upload:function(t,e){if(!this.uploadFilesPath.length&&1===t)return this.addTask();if(!this.uploadFilesPath.length&&2===t)return this.addWork();var n=this;wx.uploadFile({url:"https://www.lapichang.top/qiniu/upload",name:"file",filePath:n.uploadFilesPath[e],success:function(i){n.pubUrlArray.push(JSON.parse(i.data).data),e+1<n.uploadFilesPath.length?1===t?n.upload(1,e+1):n.upload(2,e+1):1===t?n.addTask():n.addWork()},fail:function(t){console.log("第"+(e+1)+"张图片上传失败")}})},getTaskList:function(e){var n=this;return f(i.default.mark((function e(){var r;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.get("/bwThings/getTaskList",{cid:n.current,sid:n.id});case 2:r=e.sent,n.taskList=r.data.data,n.getPubPerson(),n.imgFiles.forEach((function(t){-1===n.imgFiles2.indexOf("https://lapichang.top/"+t)&&n.imgFiles2.push("https://lapichang.top/"+t)}));case 6:case"end":return e.stop()}}),e)})))()},getWorkList:function(){var e=this;return f(i.default.mark((function n(){var r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$http.get("/bwThings/getWorkList",{cid:e.current,sid:e.id});case 2:r=n.sent,e.workList=r.data.data,e.getPubPerson(),e.imgFiles.forEach((function(t){-1===e.imgFiles2.indexOf("https://lapichang.top/"+t)&&e.imgFiles2.push("https://lapichang.top/"+t)}));case 6:case"end":return n.stop()}}),n)})))()},getStuList:function(){var e=this;return f(i.default.mark((function n(){var r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$http.get("/bwClass/getStudentList",{cid:e.cid});case 2:r=n.sent,e.stuList=r.data.data,e.srole=e.stuList.find((function(t){return t.sid===e.id})).srole;case 5:case"end":return n.stop()}}),n)})))()},getPubPerson:function(){var t=this;this.updateTotal(this.taskList.length+this.workList.length),"我的任务"===this.title?(this.pubPerson=this.stuList.find((function(e){return e.sid===t.taskList[t.index].sid})).sname,this.pubId=this.stuList.find((function(e){return e.sid===t.taskList[t.index].sid})).sid,this.taskList[this.index].fileList.forEach((function(e){-1!==t.imgType.indexOf(e.file.split(".")[1])&&-1===t.imgFiles.indexOf(e.file)?t.imgFiles.push(e.file):-1===t.imgType.indexOf(e.file.split(".")[1])&&-1===t.filesArr.indexOf(e.file)&&t.filesArr.push(e.file)}))):"我的作业"===this.title&&(this.pubPerson=this.stuList.find((function(e){return e.sid===t.workList[t.index].sid})).sname,this.pubId=this.stuList.find((function(e){return e.sid===t.workList[t.index].sid})).sid,this.workList[this.index].fileList.forEach((function(e){-1!==t.imgType.indexOf(e.file.split(".")[1])&&-1===t.imgFiles.indexOf(e.file)?t.imgFiles.push(e.file):-1===t.imgType.indexOf(e.file.split(".")[1])&&-1===t.filesArr.indexOf(e.file)&&t.filesArr.push(e.file)})))},taskUnFinished:function(){var e=this;return f(i.default.mark((function n(){var r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$http.get("/bwThings/getTaskFinishList",{tid:e.taskList[e.index].id});case 2:r=n.sent,e.taskUnFinishedList=r.data.data,e.$refs.unfi.show();case 5:case"end":return n.stop()}}),n)})))()},workUnFinished:function(){var e=this;return f(i.default.mark((function n(){var r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$http.get("/bwThings/getWorkFinishList",{wid:e.workList[e.index].id});case 2:r=n.sent,e.workUnFinishedList=r.data.data,e.$refs.unfi.show();case 5:case"end":return n.stop()}}),n)})))()},previewImg:function(e){t.previewImage({current:"https://lapichang.top/"+e,urls:this.imgFiles2})},viewFile:function(t){wx.downloadFile({url:"https://lapichang.top/"+t,success:function(t){if(200!=t.statusCode)return!1;var e=t.tempFilePath;wx.openDocument({filePath:e,showMenu:!0,success:function(t){util.hideLoading()}})}})},submitTask:function(){var e=this;return f(i.default.mark((function n(){var r,s,a,o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.showModal({title:"提示",content:"确定提交该任务吗？"}).catch((function(t){return t}));case 2:if(r=n.sent,s=u(r,2),s[0],a=s[1],!a||!a.confirm){n.next=17;break}if(e.uploadFilesPath.length){n.next=9;break}return n.abrupt("return",t.$showMsg("请选择需要上传的文件"));case 9:return t.uploadFile({url:"https://www.lapichang.top/bwThings/downloadFile/".concat(e.taskList[e.index].id),name:"file",filePath:e.uploadFilesPath[0],success:function(t){console.log("成功",t)}}),n.next=12,t.$http.delete("/bwThings/toFinishTask",{sid:e.id,id:e.taskList[e.index].id});case 12:if(o=n.sent,o.data.flag){n.next=15;break}return n.abrupt("return",e.$refs.mpopup.open({type:"err",content:"提交任务失败！",timeout:1e3}));case 15:e.$refs.mpopup.open({type:"success",content:"提交任务成功！",timeout:1e3}),setTimeout((function(){e.back()}),1e3);case 17:case"end":return n.stop()}}),n)})))()},submitWork:function(){var e=this;return f(i.default.mark((function n(){var r,s,a,o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.showModal({title:"提示",content:"确定提交该作业吗？"}).catch((function(t){return t}));case 2:if(r=n.sent,s=u(r,2),s[0],a=s[1],!a||!a.confirm){n.next=17;break}if(e.uploadFilesPath.length){n.next=9;break}return n.abrupt("return",t.$showMsg("请选择需要上传的文件"));case 9:return t.uploadFile({url:"https://www.lapichang.top/bwThings/downloadFile/".concat(e.workList[e.index].id),name:"file",filePath:e.uploadFilesPath[0],success:function(t){console.log("成功",t)}}),n.next=12,t.$http.delete("/bwThings/toFinishWork",{sid:e.id,id:e.workList[e.index].id});case 12:if(o=n.sent,o.data.flag){n.next=15;break}return n.abrupt("return",e.$refs.mpopup.open({type:"err",content:"提交作业失败！",timeout:1e3}));case 15:e.$refs.mpopup.open({type:"success",content:"提交作业成功！",timeout:1e3}),setTimeout((function(){e.back()}),1e3);case 17:case"end":return n.stop()}}),n)})))()},copyFilesUrl:function(e){var n=this;return f(i.default.mark((function r(){var s;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return console.log("获取文件",e),i.next=3,t.$http.get("/bwThings/getFinishFile",{id:e});case 3:if(s=i.sent,s.data.flag){i.next=6;break}return i.abrupt("return",t.$showMsg("目前没有已提交文件"));case 6:n.allStuSumbitUrl="https://lapichang.top/"+s.data.data,t.setClipboardData({data:n.allStuSumbitUrl,success:function(e){t.getClipboardData({success:function(e){t.$showMsg("下载链接已复制到剪切板")}})}});case 8:case"end":return i.stop()}}),r)})))()},endTask:function(){var e=this;return f(i.default.mark((function n(){var r,s,a,o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.showModal({title:"提示",content:"确定结束该任务吗？"}).catch((function(t){return t}));case 2:if(r=n.sent,s=u(r,2),s[0],a=s[1],!a||!a.confirm){n.next=15;break}return e.copyFilesUrl(e.taskList[e.index].id),n.next=10,t.$http.delete("/bwThings/endTask/".concat(e.taskList[e.index].id));case 10:if(o=n.sent,o.data.flag){n.next=13;break}return n.abrupt("return",e.$refs.mpopup.open({type:"err",content:"结束任务失败！",timeout:1e3}));case 13:e.taskUnFinishedList=o.data.data,e.$refs.unfi1.show();case 15:case"end":return n.stop()}}),n)})))()},endWork:function(){var e=this;return f(i.default.mark((function n(){var r,s,a,o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.showModal({title:"提示",content:"确定结束该作业吗？"}).catch((function(t){return t}));case 2:if(r=n.sent,s=u(r,2),s[0],a=s[1],!a||!a.confirm){n.next=16;break}return e.copyFilesUrl(e.workList[e.index].id),e.copyFilesUrl(),n.next=11,t.$http.delete("/bwThings/endWork/".concat(e.workList[e.index].id));case 11:if(o=n.sent,o.data.flag){n.next=14;break}return n.abrupt("return",e.$refs.mpopup.open({type:"err",content:"结束作业失败！",timeout:1e3}));case 14:e.workUnFinishedList=o.data.data,e.$refs.unfi1.show();case 16:case"end":return n.stop()}}),n)})))()},endBack:function(t){var e=this;this.$refs.mpopup.open({type:"success",content:"".concat(t,"已结束！"),timeout:1e3}),setTimeout((function(){e.back()}),1e3)},addTask:function(){var e=this;return f(i.default.mark((function n(){var r,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={cid:e.cid,sid:e.id,title:e.taskTitle,detail:e.taskDetail,endtime:e.datetimesingle,files:JSON.parse(JSON.stringify(e.pubUrlArray)).toString()},n.next=3,t.$http.post("/bwThings/addNewTask",r);case 3:if(s=n.sent,s.data.flag){n.next=6;break}return n.abrupt("return",e.$refs.mpopup.open({type:"err",content:"发布失败！",timeout:1e3}));case 6:e.getTaskList(),e.$refs.mpopup.open({type:"success",content:"发布成功！",timeout:1e3}),setTimeout((function(){t.switchTab({url:"../../pages/class/class"})}),1e3);case 9:case"end":return n.stop()}}),n)})))()},addWork:function(){var e=this;return f(i.default.mark((function n(){var r,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={cid:e.cid,sid:e.id,title:e.taskTitle,detail:e.taskDetail,endtime:e.datetimesingle,files:JSON.parse(JSON.stringify(e.pubUrlArray)).toString()},n.next=3,t.$http.post("/bwThings/addNewWork",r);case 3:if(s=n.sent,s.data.flag){n.next=6;break}return n.abrupt("return",e.$refs.mpopup.open({type:"err",content:"发布失败！",timeout:1e3}));case 6:e.getTaskList(),e.$refs.mpopup.open({type:"success",content:"发布成功！",timeout:1e3}),setTimeout((function(){t.switchTab({url:"../../pages/class/class"})}),1e3);case 9:case"end":return n.stop()}}),n)})))()}}};e.default=L}).call(this,n("543d")["default"])},6636:function(t,e,n){"use strict";(function(t){n("8cd2");i(n("66fd"));var e=i(n("3619"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},"6fd6":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}));var i={uniNavBar:function(){return n.e("uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar").then(n.bind(null,"a93d"))},uniFilePicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(n.bind(null,"c489"))},uniDatetimePicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker")]).then(n.bind(null,"bd42"))},wybPopup:function(){return n.e("components/wyb-popup/wyb-popup").then(n.bind(null,"aa77"))}},r=function(){var t=this,e=t.$createElement,n=(t._self._c,t.title.slice(2));t.$mp.data=Object.assign({},{$root:{g0:n}})},s=[]},9833:function(t,e,n){"use strict";var i=n("2daa"),r=n.n(i);r.a}},[["6636","common/runtime","common/vendor"]]]);